#!/usr/bin/env bash
set -euo pipefail

if [[ $EUID -ne 0 ]]; then
    echo "Run as root: sudo $0"
    exit 1
fi

if grep -q "^\[chaotic-aur\]" /etc/pacman.conf; then
    echo "chaotic-aur is already configured."
else
    pacman-key --recv-key 3056513887B78AEB --keyserver keyserver.ubuntu.com
    pacman-key --lsign-key 3056513887B78AEB

    pacman -U --noconfirm \
      "https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-keyring.pkg.tar.zst" \
      "https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-mirrorlist.pkg.tar.zst"

    {
      echo ""
      echo "[chaotic-aur]"
      echo "Include = /etc/pacman.d/chaotic-mirrorlist"
    } >> /etc/pacman.conf
fi

pacman -Syy
echo "chaotic-aur enabled."
